<%
@omnifocus = []

[*"1".."7", "t", "c"].each do |weekday|
  ["defer", "due"].each do |type|
    # The bundle id of the app store version has a ".MacAppStore" suffix
    conditions = [ { bundle_identifiers: [ "^com.omnigroup.OmniFocus2" ], type: "frontmost_application_if" } ]
    from = { key_code: weekday, modifiers: { mandatory: [ "right_shift" ] } }
    to = [ { shell_command:  "$HOME/Dropbox/omnifocus/set-date.applescript #{type} #{weekday}" } ]
    if type == "due"
      from[:modifiers][:mandatory] << "right_option"
    else
      from[:modifiers][:mandatory] << "right_control"
    end
    @omnifocus << { conditions: conditions, from: from, to: to, type: "basic" }
  end
end

%>
{
   "description": "Omnifocus",
   "manipulators": <%= JSON.generate(@omnifocus) %>
 }
